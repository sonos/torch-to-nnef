extension tract_registry tract_core;

# way to bypass tract limitation with regard to out of boundary
# slices indexes

fragment pick_index_in_axis(
    index: tensor<scalar>,
    input_axis_size: tensor<scalar>
) -> ( positive_index: tensor<scalar> )
{
    cond = ge(index, 0);
    offset = select(cond, 0, input_axis_size);
    positive_index = tract_core_cast(min(max(0, offset + index), input_axis_size), to="tdim");
}
